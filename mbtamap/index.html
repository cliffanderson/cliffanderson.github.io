<html>
  <head>
    <style>
      #map-canvas
      {
        width: 1200px;
        height: 700px;
      }
    </style>

    <script src="https://maps.googleapis.com/maps/api/js"> </script>

    <script>
      var map;
      var markers = [];

      var lines = ['blue', 'red', 'orange', 'green-b', 'green-c', 'green-d', 'green-e'];
      var lineOverlay = ['blue', 'red-ashmont', 'red-braintree', 'orange', 'green-b', 'green-c', 'green-d', 'green-e'];

      var commLines = ['CR-Fairmount', 'CR-Fitchburg', 'CR-Franklin', 'CR-Greenbush',
      'CR-Haverhill', 'CR-Kingston', 'CR-Lowell', 'CR-Middleborough', 'CR-Needham',
      'CR-Newburyport', 'CR-Providence', 'Worcester'];
      var commLineOverlay = ['CR-Fairmount', 'CR-Fitchburg', 'CR-Franklin', 'CR-Greenbush',
      'CR-Haverhill', 'CR-Kingston', 'CR-Lowell', 'CR-Middleborough', 'CR-Needham',
      'CR-Newburyport', 'CR-Providence', 'CR-Providence-Stoughton', 'CR-Worcester'];

      var colors = {'blue': '#00A3E7', 'red-ashmont': '#FF0000', 'red-braintree': '#FF0000',
       'orange': '#FFA500', 'green-b': '#00B351', 'green-c': '#00B351', 'green-d': '#00B351',
       'green-e': '#00B351'};

      google.maps.event.addDomListener(window, 'load', initialize);


      //function to initialize
      function initialize()
      {
        var boston = new google.maps.LatLng(42.3479, -71.087667);

        var mapCanvas = document.getElementById('map-canvas');
        var mapOptions =
        {
          //center: new google.maps.LatLng(44.5403, -78.5463),
          center:boston,
          zoom: 13,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        }
        map = new google.maps.Map(mapCanvas, mapOptions);

        //make roads less invasive
        var styles = [
          {
            featureType: "road",
            elementType: "geometry",
            stylers: [
              { lightness: 100 },
              { visibility: "simplified" }
            ]
          }
        ];
        map.setOptions({styles: styles});


          google.maps.event.addListenerOnce(map, 'idle', function()
          {
            //load subways
            for(var i in lines)
            {
              loadDataForTrain(lines[i]);
            }

            //load subway lines
            for(var i in lineOverlay)
            {
              loadLine(lineOverlay[i], colors[lineOverlay[i]]);
            }

            //load commuter lines
            for(var i in commLineOverlay)
            {
              loadCommLine(commLineOverlay[i], '#F524FB');
            }
          });
      }





      function loadDataForTrain(line)
      {
        var request = new XMLHttpRequest();

        request.open('GET', 'trains/' + line + '.txt', false);
        request.send();

        var image =
        {
          url: 'images/' + line + '.png',
          anchor: new google.maps.Point(15,15)
        }
        parseTrains(request.responseText, image);
      }





      function parseTrains(data, image)
      {
        //console.log("Data:" +  data);

        //document.write(data);
        var coords = data.split('\n');
        var marks = [];

        for(var i in coords)
        {
          var nums = coords[i].split(" ");
          marks.push({"lat" : nums[0], "lon" : nums[1]});
        }

        for(var i in marks)
        {
          var mark = new google.maps.Marker(
            {
              position: new google.maps.LatLng(marks[i].lat, marks[i].lon),
              icon: image,
              title: 'test'
            }
          );

          mark.setMap(map);
          markers.push(mark);
        }
      }


      function loadCommLine(line, color)
      {
        var path = [];

        var request = new XMLHttpRequest();

        console.log("Getting: " + 'commuter-routes/' + line + '.txt');
        request.open('GET', 'commuter-routes/' + line + '.txt', false);
        request.send();

        var data = request.responseText;
        data = data.split('\n');

        for(var i = 0; i < data.length - 1; i++)
        {
          var pieces = data[i].split(' ');

          var lat = pieces[pieces.length-2];
          var lng = pieces[pieces.length-1];
          var place = new google.maps.LatLng(lat, lng);

          path.push(place);


          var name = '';

          for(var j = 0; j < pieces.length - 2; j++)
          {
            name += pieces[j];
          }

          //marker to represent station
          var marker = new google.maps.Marker(
            {
              position: place,
              icon:
              {
                path: google.maps.SymbolPath.CIRCLE,
                scale: 5,
              },
              map: map,
              title: name
            }
          );

        }

        //console.log('line: ' + line + "  " + path);

        //put path on map
        var pathOnMap = new google.maps.Polyline(
          {
            path: path,
            geodesic: true,
            strokeColor: color,
            strokeOpacity: 1.0,
            strokeWeight: 4
          }
        );

        pathOnMap.setMap(map);

      }




      function loadLine(line, color)
      {
        var path = [];

        var request = new XMLHttpRequest();

        console.log("Getting: " + 'routes/' + line + '.txt');
        request.open('GET', 'routes/' + line + '.txt', false);
        request.send();

        var data = request.responseText;
        data = data.split('\n');

        for(var i = 0; i < data.length - 1; i++)
        {
          var pieces = data[i].split(' ');

          var lat = pieces[pieces.length-2];
          var lng = pieces[pieces.length-1];
          var place = new google.maps.LatLng(lat, lng);

          path.push(place);


          var name = '';

          for(var j = 0; j < pieces.length - 2; j++)
          {
            name += pieces[j];
          }

          //marker to represent station
          var marker = new google.maps.Marker(
            {
              position: place,
              icon:
              {
                path: google.maps.SymbolPath.CIRCLE,
                scale: 5,
              },
              map: map,
              title: name
            }
          );

        }

      //  console.log('line: ' + line + "  " + path);

        //put path on map
        var pathOnMap = new google.maps.Polyline(
          {
            path: path,
            geodesic: true,
            strokeColor: color,
            strokeOpacity: 1.0,
            strokeWeight: 4
          }
        );

        pathOnMap.setMap(map);

      }

    </script>
  </head>
  <body>
    <div id="map-canvas"></div>
  </body>
</html>
